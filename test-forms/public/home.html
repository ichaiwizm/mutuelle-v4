<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accueil - Mutuelle Test</title>
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>Bienvenue dans votre espace client</h1>
      <p class="subtitle">Gérez vos simulations et devis en quelques clics</p>
    </header>

    <div class="actions-section">
      <div class="card card-primary">
        <h2>Nouvelle simulation</h2>
        <p>Obtenez un devis personnalisé pour votre mutuelle santé</p>
        <button
          class="btn btn-primary btn-large"
          data-testid="new-simulation-button"
          onclick="window.location.href='/form.html'"
        >
          Commencer une simulation
        </button>
      </div>

      <div class="card">
        <h2>Mes simulations précédentes</h2>
        <p>Retrouvez l'historique de vos demandes de devis</p>
        <div id="quotes-list" data-testid="quotes-list">
          <p class="loading">Chargement...</p>
        </div>
      </div>
    </div>
  </div>

  <script src="/scripts/navigation.js"></script>
  <script>
    // Load previous quotes
    async function loadQuotes() {
      try {
        const response = await fetch('/api/quotes');
        const result = await response.json();

        const container = document.getElementById('quotes-list');

        if (result.success && result.quotes.length > 0) {
          container.innerHTML = `
            <ul class="quotes-list">
              ${result.quotes.map(quote => `
                <li>
                  <a href="/quote.html?id=${quote.id}">
                    <strong>${quote.data.subscriber.prenom} ${quote.data.subscriber.nom}</strong>
                    <span class="quote-price">${quote.price}€/mois</span>
                    <small>${new Date(quote.timestamp).toLocaleString('fr-FR')}</small>
                  </a>
                </li>
              `).join('')}
            </ul>
          `;
        } else {
          container.innerHTML = '<p class="no-data">Aucune simulation pour le moment</p>';
        }
      } catch (error) {
        console.error('Error loading quotes:', error);
        document.getElementById('quotes-list').innerHTML = '<p class="error-text">Erreur de chargement</p>';
      }
    }

    // Load quotes on page load
    loadQuotes();
  </script>
</body>
</html>
